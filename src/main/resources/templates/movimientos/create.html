<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Registrar Movimiento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-success text-white py-3"><h3 class="mb-0">Registrar Movimiento</h3></div>
                <div class="card-body p-4">
                    <div th:if="${error}" class="alert alert-danger" role="alert">
                        <span th:text="${error}"></span>
                    </div>
                    <form th:action="@{/movimientos/guardar}" method="post" th:object="${movimiento}">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label fw-bold">Producto</label>
                                <select class="form-select form-select-lg" name="producto.id_producto" required>
                                    <option value="">-- Seleccionar --</option>
                                    <option th:each="p : ${productos}" th:value="${p.id_producto}" th:text="${p.nombre_producto} + ' (Caja de ' + ${p.unidades_por_caja} + ' u.)'"></option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Tipo de Acci칩n</label>
                                <select class="form-select" field="*{tipo_movimiento}" name="tipo_movimiento" id="tipoMovimiento" onchange="cambiarLabels()" required>
                                    <option value="Entrada">游닌 Entrada (Compra)</option>
                                    <option value="Salida">游닋 Salida (Venta)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold" id="lblCantidad">Cantidad (Cajas)</label>
                                <input type="number" class="form-control" field="*{cantidad}" name="cantidad" required min="1">
                            </div>
                            <div class="col-md-12">
                                <label class="form-label fw-bold" id="lblCosto">Costo Total de la Compra ($)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" step="0.01" class="form-control" field="*{costo}" name="costo">
                                </div>
                                <small class="text-muted" id="helpCosto">Calcularemos el nuevo precio unitario autom치ticamente.</small>
                            </div>
                        </div>
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-success btn-lg">Guardar Movimiento</button>
                            <a href="/movimientos" class="btn btn-outline-secondary">Cancelar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function cambiarLabels() {
        let tipo = document.getElementById("tipoMovimiento").value;
        if(tipo === "Entrada") {
            document.getElementById("lblCantidad").innerText = "Cantidad (Cajas)";
            document.getElementById("lblCosto").innerText = "Costo Total de la Compra ($)";
            document.getElementById("helpCosto").style.display = "block";
        } else {
            document.getElementById("lblCantidad").innerText = "Cantidad (Unidades a Vender)";
            document.getElementById("lblCosto").innerText = "Monto Cobrado (Calculado Autom치tico)";
            document.getElementById("helpCosto").style.display = "none";
        }
    }
</script>
</body>
</html>